<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>BlogMatsumoto</title>
<link>https://your-website-url.example.com/</link>
<atom:link href="https://your-website-url.example.com/index.xml" rel="self" type="application/rss+xml"/>
<description>A blog built with Quarto</description>
<generator>quarto-1.8.25</generator>
<lastBuildDate>Thu, 13 Nov 2025 03:00:00 GMT</lastBuildDate>
<item>
  <title>Regressão Linear</title>
  <link>https://your-website-url.example.com/posts/Regressao_linear/</link>
  <description><![CDATA[ 





<section id="resumo" class="level2">
<h2 class="anchored" data-anchor-id="resumo">Resumo</h2>
<p>Nesta tarefa foi aplicada a técnica de <strong>regressão linear</strong> para analisar a relação entre os <strong>anos de estudo (X)</strong> e o <strong>salário (y)</strong>.<br>
Os dados são carregados de arquivos <code>.txt</code> e os coeficientes são calculados manualmente com a <strong>fórmula matricial</strong>.<br>
Foram utilizados dois métodos de visualização: <strong>plotnine (matplotlib/ggplot-style)</strong> e <strong>Plotly (interativo)</strong>.</p>
<hr>
</section>
<section id="objetivo" class="level2">
<h2 class="anchored" data-anchor-id="objetivo">Objetivo</h2>
<p>Calcular os coeficientes da regressão linear por meio da fórmula matricial e exibir o gráfico resultante utilizando duas bibliotecas diferentes.</p>
<hr>
</section>
<section id="como-pensei" class="level2">
<h2 class="anchored" data-anchor-id="como-pensei">Como pensei</h2>
<p>Para resolver esse exercício eu trabalhei com duas abordagens.</p>
<section id="código-usando-plotnine" class="level3">
<h3 class="anchored" data-anchor-id="código-usando-plotnine">1. Código usando <code>plotnine</code></h3>
<p>Nesse caso, a lógica da regressão já estava pronta no código base.<br>
O que eu fiz foi <strong>adaptar a entrada dos dados</strong>:<br>
- Removi valores fixos escritos diretamente no código<br>
- Passei a carregar tudo usando <code>np.loadtxt("x.txt")</code> e <code>np.loadtxt("y.txt")</code></p>
<hr>
</section>
<section id="código-usando-plotly" class="level3">
<h3 class="anchored" data-anchor-id="código-usando-plotly">2. Código usando <code>Plotly</code></h3>
<p>Aqui eu implementei <strong>todo o processo completo</strong>:<br>
- carregar os dados<br>
- montar a matriz X (com coluna de 1s)<br>
- aplicar a <strong>fórmula matricial da regressão linear</strong><br>
- calcular o R² manualmente<br>
- gerar o gráfico interativo<br>
- salvar em HTML</p>
<p>Essa versão foi construída passo a passo a partir da matemática da regressão e resultou em um gráfico interativo.</p>
<hr>
</section>
</section>
<section id="código-em-python" class="level2">
<h2 class="anchored" data-anchor-id="código-em-python">Código em Python</h2>
<p>O código completo pode ser visto <a href="regressao2.py.py">aqui</a>.<br>
Regressão Linear: <a href="grafico2.png">aqui</a>.</p>
<p>#| echo: false #| fig-cap: “Regressão linear (Plotnine)”</p>
<pre><code>import numpy as np
from plotnine import (
    ggplot, aes, geom_point, geom_abline, theme, element_text
)
import pandas as pd

# Ler os arquivos
valores_x = np.loadtxt("x.txt")
valores_y = np.loadtxt("y.txt")

# Calcular coeficientes da regressão
X = np.column_stack((np.ones(len(valores_x)), valores_x))
beta = np.linalg.inv(X.T @ X) @ X.T @ valores_y

a = float(beta[0])   # intercepto
b = float(beta[1])   # inclinação

print("a =", a)
print("b =", b)

df = {"x": valores_x, "y": valores_y}

plot = (
    ggplot(pd.DataFrame(df), aes("x", "y"))
    + geom_point()
    + geom_abline(intercept=a, slope=b)
)

plot.save("grafico2.png", dpi=300)

print("Gráfico salvo como grafico2.png")</code></pre>
</section>
<section id="código-em-python-ploty" class="level2">
<h2 class="anchored" data-anchor-id="código-em-python-ploty">Código em Python — Ploty</h2>
<p>O código completo pode be visto <a href="regressao.py">aqui</a>.<br>
Regressão Linear: <a href="grafico.html">aqui</a>.</p>
<pre><code>import numpy as np
import plotly.graph_objects as go
from sklearn.linear_model import LinearRegression

# Lê os dados dos arquivos
x = np.loadtxt('x.txt')
y = np.loadtxt('y.txt')

# Ajusta o formato dos dados
x = x.reshape(-1, 1)

# Cria e treina o modelo de regressão
modelo = LinearRegression()
modelo.fit(x, y)

# Faz previsões
y_pred = modelo.predict(x)

# Exibe os coeficientes
a = modelo.coef_[0]
b = modelo.intercept_
print(f"Equação da reta: y = {a:.4f}x + {b:.4f}")

# Cria o gráfico interativo
fig = go.Figure()

# Adiciona os pontos reais
fig.add_trace(go.Scatter(
    x=x.flatten(), y=y,
    mode='markers',
    name='Pontos reais',
    marker=dict(color='blue', size=8)
))

# Adiciona a reta de regressão
fig.add_trace(go.Scatter(
    x=x.flatten(), y=y_pred,
    mode='lines',
    name='Reta de regressão',
    line=dict(color='red', width=2)
))

# Configura layout
fig.update_layout(
    title='Regressão Linear',
    xaxis_title='X',
    yaxis_title='Y',
    template='plotly_white'
)

# Salva o gráfico em HTML
fig.write_html('grafico.html')</code></pre>


</section>

 ]]></description>
  <category>Python</category>
  <category>Matemática</category>
  <category>Plotly</category>
  <guid>https://your-website-url.example.com/posts/Regressao_linear/</guid>
  <pubDate>Thu, 13 Nov 2025 03:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/Regressao_linear/grafico2.png" medium="image" type="image/png" height="108" width="144"/>
</item>
<item>
  <title>Monitoramento de Frota de Ônibus</title>
  <link>https://your-website-url.example.com/posts/Monitoramento_frota/</link>
  <description><![CDATA[ 





<section id="resumo" class="level2">
<h2 class="anchored" data-anchor-id="resumo">Resumo</h2>
<p>O objetivo desta atividade foi construir um <strong>mapa interativo</strong> com as <strong>paradas de uma linha de ônibus</strong> e as <strong>posições em tempo real dos veículos</strong>.<br>
A aplicação consulta a <strong>API Olho Vivo (SPTrans)</strong>, utiliza um <strong>token de autenticação</strong> e exibe no mapa duas camadas:<br>
- <strong>Paradas (pinos azuis)</strong><br>
- <strong>Ônibus em tempo real (pinos vermelhos)</strong></p>
<p>O resultado final é um mapa dinâmico que facilita visualizar a operação da linha.</p>
<hr>
</section>
<section id="objetivo" class="level2">
<h2 class="anchored" data-anchor-id="objetivo">Objetivo</h2>
<p>Representar no mapa tanto as paradas fixas quanto os ônibus em movimento de uma linha específica.</p>
<hr>
</section>
<section id="como-pensei-explicação-curta" class="level2">
<h2 class="anchored" data-anchor-id="como-pensei-explicação-curta">Como pensei (explicação curta)</h2>
<p>Comecei carregando o token do arquivo <code>.env</code> e autenticando na API usando <code>requests.Session</code>, pois essa API exige manter a sessão válida após o login.<br>
Em seguida busquei a linha pelo nome (“875A”), já que a API retorna o <strong>código interno da linha</strong>, que é necessário para consultar paradas e posições.</p>
<p>Com o código e o sentido retornados, fiz a requisição das paradas e utilizei suas coordenadas para criar um mapa com o <strong>Folium</strong>, adicionando um pino azul para cada parada.<br>
Depois consultei o endpoint de posição e, se houvesse ônibus circulando, adicionei pinos vermelhos mostrando o veículo e sua localização atual.</p>
<p>Por fim salvei tudo em um arquivo HTML, permitindo visualizar paradas + frota em tempo real diretamente no navegador.</p>
<hr>
</section>
<section id="código-em-python" class="level2">
<h2 class="anchored" data-anchor-id="código-em-python">Código em Python</h2>
<p>O código completo <a href="frota_onibus.py">aqui</a>.<br>
Rota gerada no mapa: <a href="mapa_frota_875A-10.html">mapa_frota_875A-10</a>.</p>
<hr>
</section>
<section id="código-em-python-1" class="level2">
<h2 class="anchored" data-anchor-id="código-em-python-1">Código em Python</h2>
<p>#| echo: false #| fig-cap: “Monitoramento de frota de ônibus - Linha 875A-10 - Perdizes ↔︎ Aeroporto de Congonhas (via Av. Washington Luiz, Av. Jabaquara)”</p>
<pre><code>import os
import requests
import folium
from dotenv import load_dotenv

load_dotenv(".env")
TOKEN = os.getenv("SPTRANS_TOKEN")

s = requests.Session()
auth = s.post(f"http://api.olhovivo.sptrans.com.br/v2.1/Login/Autenticar?token={TOKEN}")

if auth.text.lower() != "true":
    print("Falha na autenticação com o token SPTrans.")
    exit()

linha_nome = "875A"
url_linhas = f"http://api.olhovivo.sptrans.com.br/v2.1/Linha/Buscar?termosBusca={linha_nome}"
res_linhas = s.get(url_linhas)
linhas = res_linhas.json()

if not linhas:
    print("Nenhuma linha encontrada.")
    exit()

# Exibe as direções disponíveis
for i, l in enumerate(linhas, start=1):
    sentido = "Ida" if l["sl"] == 1 else "Volta"
    print(f"{i}. {l['lt']} - {l['tp']} → {l['ts']} ({sentido}) | Código: {l['cl']}")

# Usa a primeira linha retornada
linha = linhas[0]
codigo_linha = linha["cl"]
sentido = linha["sl"]

print(f"\nLinha selecionada: {linha['lt']} - {linha['tp']} → {linha['ts']} ({'Ida' if sentido == 1 else 'Volta'})")

# Buscar paradas da linha
url_paradas = f"http://api.olhovivo.sptrans.com.br/v2.1/Parada/BuscarParadasPorLinha?codigoLinha={codigo_linha}&amp;sentido={sentido}"
res_paradas = s.get(url_paradas)
paradas = res_paradas.json()

if not paradas:
    print("Nenhuma parada encontrada para esta linha e sentido.")
    exit()

# Criação do mapa
mapa = folium.Map(location=[paradas[0]["py"], paradas[0]["px"]], zoom_start=13)

# Pinos azuis = paradas
for parada in paradas:
    folium.Marker(
        [parada["py"], parada["px"]],
        popup=parada["np"],
        icon=folium.Icon(color="blue", icon="bus", prefix="fa")
    ).add_to(mapa)

# Posições em tempo real
url_posicoes = f"http://api.olhovivo.sptrans.com.br/v2.1/Posicao?codigoLinha={codigo_linha}"
res_posicoes = s.get(url_posicoes)
dados_posicao = res_posicoes.json()

veiculos = []
if dados_posicao and "vs" in dados_posicao:
    veiculos = dados_posicao["vs"]

# Pinos vermelhos = ônibus
if veiculos:
    for v in veiculos:
        folium.Marker(
            [v["py"], v["px"]],
            popup=f"Ônibus {v['p']}",
            icon=folium.Icon(color="red", icon="location-dot", prefix="fa")
        ).add_to(mapa)
else:
    print("Nenhum ônibus encontrado em tempo real no momento.")

# Linha 875A-10 - Perdizes ↔ Aeroporto de Congonhas (via Av. Washington Luiz, Av. Jabaquara) 
mapa.save("mapa_frota_875A-10.html")
print("Pinos azuis = paradas | Pinos vermelhos = ônibus em tempo real")</code></pre>


</section>

 ]]></description>
  <category>Python</category>
  <category>API</category>
  <category>Mapas</category>
  <guid>https://your-website-url.example.com/posts/Monitoramento_frota/</guid>
  <pubDate>Tue, 11 Nov 2025 03:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/Monitoramento_frota/frota.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Cotação do Dólar por Período</title>
  <link>https://your-website-url.example.com/posts/cotacao_dolar/</link>
  <description><![CDATA[ 





<section id="resumo" class="level2">
<h2 class="anchored" data-anchor-id="resumo">Resumo</h2>
<p>Nesta atividade foi desenvolvida uma rotina em <strong>Python</strong> que consulta a <strong>API do Banco Central (PTAX)</strong> para obter a cotação do dólar em um período específico.<br>
A função recebe uma string no formato <code>"MMYYYY"</code> e determina automaticamente as datas inicial e final do mês.<br>
Os dados são processados com <strong>Pandas</strong> e visualizados em um <strong>gráfico de linha interativo com Plotly</strong>.</p>
<hr>
</section>
<section id="objetivo" class="level2">
<h2 class="anchored" data-anchor-id="objetivo">Objetivo</h2>
<p>Criar um código que receba como parâmetro <code>"MMYYYY"</code> e gere um gráfico com a cotação do dólar no período correspondente.</p>
<hr>
</section>
<section id="como-pensei" class="level2">
<h2 class="anchored" data-anchor-id="como-pensei">Como pensei</h2>
<p>Primeiro converti a string <code>"MMYYYY"</code> em um objeto <code>datetime</code> para obter o ano e o mês. Usei o <code>calendar.monthrange</code> para descobrir o último dia do mês e assim montar as datas inicial e final exigidas pela API. Em seguida fiz a requisição, transformei o JSON em <code>DataFrame</code> para ordenar e tratar as datas, e finalmente plotei a série temporal com <code>plotly.express</code>. Salvei o gráfico como <code>grafico_dolar.html</code> para facilitar a visualização no blog.</p>
<hr>
</section>
<section id="código-em-python" class="level2">
<h2 class="anchored" data-anchor-id="código-em-python">Código em Python</h2>
<p>O código completo pode ser visto <a href="dolar.py">aqui</a>.<br>
Gráfico <a href="grafico_dolar.html">aqui</a>.</p>
<hr>
</section>
<section id="resultado" class="level2">
<h2 class="anchored" data-anchor-id="resultado">Resultado</h2>
<p>#| echo: false #| fig-cap: “Cotação do Dólar em Agosto de 2025” import requests import pandas as pd import plotly.express as px import calendar from datetime import datetime</p>
<pre><code>def cotacao_dolar_periodo(mes_ano: str):
    # Converte string "MMYYYY" em datas inicial e final
    first_date = datetime.strptime(mes_ano, "%m%Y")
    last_day = calendar.monthrange(first_date.year, first_date.month)[1]

    data_inicial = first_date.strftime("%m-%d-%Y")
    data_final = first_date.replace(day=last_day).strftime("%m-%d-%Y")

    # Monta a URL da API
    url = (
        "https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/"
        f"CotacaoDolarPeriodo(dataInicial=@dataInicial,dataFinalCotacao=@dataFinalCotacao)?"
        f"@dataInicial='{data_inicial}'&amp;@dataFinalCotacao='{data_final}'&amp;"
        "$top=1000&amp;$format=json&amp;$select=cotacaoCompra,dataHoraCotacao"
    )

    # Faz a requisição
    r = requests.get(url)
    if r.status_code != 200:
        raise Exception("Erro ao acessar a API do Banco Central")

    dados = r.json().get("value", [])
    if not dados:
        raise Exception("Nenhum dado retornado pela API")

    # Converte para DataFrame
    df = pd.DataFrame(dados)
    df["dataHoraCotacao"] = pd.to_datetime(df["dataHoraCotacao"])
    df = df.sort_values("dataHoraCotacao")

    # Cria o gráfico
    fig = px.line(
        df,
        x="dataHoraCotacao",
        y="cotacaoCompra",
        title=f"Cotação do Dólar - {first_date.strftime('%B de %Y')}",
        labels={"dataHoraCotacao": "Data", "cotacaoCompra": "Cotação (R$)"}
    )
    fig.write_html("grafico_dolar.html")
    print("Gráfico salvo em grafico_dolar.html — abra no navegador.")

cotacao_dolar_periodo("082025")</code></pre>


</section>

 ]]></description>
  <category>Python</category>
  <category>API</category>
  <category>Plotly</category>
  <guid>https://your-website-url.example.com/posts/cotacao_dolar/</guid>
  <pubDate>Mon, 10 Nov 2025 03:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/cotacao_dolar/grafico.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
